name: Daily News

on:
  schedule:
    - cron: "0 4 * * *"
  push:
    branches:
      - main
  workflow_dispatch: {}

permissions:
  contents: write
  models: read

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Generate daily markdown
        run: |
          python3 scripts/generate_rss_markdown.py \
            --list "https://bsky.app/profile/anton.galiglobal.com/lists/3m6ajdjbhnu27" \
            --github-input "config/github_repos.json" \
            --blogs-input "config/blogs.json"

      - name: Install uv
        run: python3 -m pip install --upgrade uv

      - name: Summarize long entries
        run: uv tool run --from azure-ai-inference python3 scripts/summarize_long_entries.py --max-chars 300
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Format markdown with rumdl
        run: python3 scripts/format_daily_news.py

      - name: Commit changes
        run: python3 scripts/commit_daily_news.py
